<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>商品</title>

    <link rel="shortcut icon" href="../../static/favicon.ico">
    <link href="../../static/css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../../static/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../static/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../../static/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="../../static/css/animate.css" rel="stylesheet">

    <script src="../../static/js/jquery.min.js?v=2.1.4"></script>
    <script src="../../static/js/bootstrap.min.js?v=3.3.6"></script>
    <script src="../../static/js/plugins/jeditable/jquery.jeditable.js"></script>
    <script src="../../static/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="../../static/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="../../static/js/content.js?v=1.0.0"></script>
    <script src="http://tajs.qq.com/stats?sId=9051096"></script>
    <script src="../../static/myjs/dataConvert.js"></script>
    <script src="../../static/myjs/jquery.serializejson.min.js"></script>
    <script src="../../static/myjs/crud.js"></script>
    <script src="../../static/myjs/updateImg.js"></script>
    <script src="../../static/myjs/menu.js"></script>

    <script>
        /* 保存分页信息 */
        var pageData;

        /* 商品Controller Url */
        var commonUrl = "../../manager/product";

        /* 维护分页信息*/
        var pageSize = 10;
        var criteria;

        /* 显示数据 */
        function showData(pageNum) {

            var mapping = "/list";
            var url = commonUrl + mapping + "/" + pageNum + "/" + pageSize;
            if (null != criteria && criteria != '') {
                url = url + "?criteria=" + criteria;
            }

            $.ajax({
                type: "get",
                url: url,
                async: false,
                success: function (data) {
                    if (data.code == '200') {
                        pageData = data.data;
                        var list = data.data.list;
                        var addHtml = '';
                        for (var i = 0; i < list.length; i++) {
                            addHtml += '<tr>';
                            addHtml += '<th>' + list[i].productId + '</th>';
                            addHtml += '<th>' + list[i].title + '</th>';
                            addHtml += '<th style="text-align:center">' + list[i].price + '</th>';
                            addHtml += '<th style="text-align:center">' + barCode(list[i].barcode) + '</th>';
                            addHtml += '<th style="text-align:center">' + proType(list[i].productCatDo.productCatName) + '</th>';
                            addHtml += '<th style="text-align:center">' + statusProcess(list[i].productStatus) + '</th>';
                            addHtml += '<th style="text-align:center">' + list[i].createOper + '</th>';
                            addHtml += '<th style="text-align:center">' + fmtData(list[i].createTime) + '</th>';
                            addHtml += '<th style="text-align:center">' + list[i].lastupdateOper + '</th>';
                            addHtml += '<th style="text-align:center">' + fmtData(list[i].lastupdateTime) + '</th>';
                            addHtml += '<th style="text-align:center">';
                            addHtml += '<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal" onclick="dataDisplay(' + list[i].productId + ')">修改</button>&nbsp;';
                            addHtml += '<button type="button" class="btn btn-danger btn-sm" onclick="del(' + list[i].productId + ')">删除</button></th>';
                            addHtml += '</tr>';
                        }
                        $(".ibox-content tbody").html(addHtml);
                        $('#iframePageInfo').attr('src', "../base/pageInfo.html");
                    }
                }
            });
        }

        /* 状态处理 */
        function statusProcess(statusCode) {
            switch (statusCode) {
                case 0:
                    return '无效';
                case 1:
                    return '有效';
                default:
                    return '--';
            }
        }

        /* 商品条码处理 */
        function barCode(code) {
            return (null == code || '' == code) ? "--" : code;
        }

        /* 商品类型处理 */
        function proType(type) {
            return (null == type || '' == type) ? "--" : type;
        }


        /* 清空表单 */
        function clearForm() {
            $("#myModal input").val("");
            $("#myModal .dropdown").css("display", "none");
            $("#myModal .dropdown").first().css("display", "block");
            $("#dropdown1 button").text("--请选择--");
            $("#dropdown1 button").append("<span class=\"caret\"></span>");

            cleanImg();

            $("#submitForm").val("add");
        }

        /* 数据回显 */
        function dataDisplay(id) {
            var mapping = "/getById";
            $.get(commonUrl + mapping + "?id=" + id, function (data) {
                if(200 == data.code) {
                    var productDo = data.data.productDo;
                    $("input[name='productId']").val(productDo.productId);
                    $("input[name='title']").val(productDo.title);
                    $("input[name='sellPoint']").val(productDo.sellPoint);
                    $("input[name='price']").val(productDo.price);
                    $("input[name='cid']").val(productDo.cid);
                    $("input[name='image']").val(productDo.image);

                    var images = productDo.image
                    var imageArray = images.split(",");
                    for(var i = 0; i < imageArray.length; i++) {
                        $("#img0" + i).css("display", "inline");
                        $("#img0" + i).attr("src", imageArray[i].replace(",", ""));
                    }

                    var menu1 = data.data.menu01;
                    var menu2 = data.data.menu02;
                    var menu3 = data.data.menu03;
                    if(null != menu1) {
                        $("#dropdown3 button").text(menu1.productCatName);
                        $("#cidValue").val(menu1.parentId);
                    }
                    if(null != menu2) {
                        $("#dropdown2 button").text(menu2.productCatName);
                    }
                    if(null != menu3) {
                        $("#dropdown1 button").text(menu3.productCatName);
                    }
                    $("#dropdown2").css("display", "block");
                    $("#dropdown3").css("display", "block");
                }
            });

            $("#submitForm").val("update");
        }

    </script>
</head>

<body class="gray-bg">

<script>

    $(function () {
        /* 页面初加载 */
        showData(1);

    });

</script>

<div class="wrapper wrapper-content animated fadeInRight">
    <!-- 提示框 -->
    <div class="alert alert-success" id="alertSuccess01" style="display: none;">
    </div>
    <div class="alert alert-danger" id="alertFail01" style="display: none;">
    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h3>商品信息</h3>
                </div>
                <div class="ibox-content">

                    <!-- 页显示数 & 查询条件 -->
                    <iframe src="../base/pageSize.html" id="iframePageSize" frameBorder="0" scrolling="no"
                            style="width: 99%; height: 55px"></iframe>

                    <!-- 新增按键 -->
                    <button id="add" onclick="clearForm()" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                        新增商品
                    </button>

                    <br/>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th style="text-align:center">商品ID</th>
                            <th style="text-align:center">商品名称</th>
                            <th style="text-align:center">价格</th>
                            <th style="text-align:center">条码</th>
                            <th style="text-align:center">商品类别</th>
                            <th style="text-align:center">商品状态</th>
                            <th style="text-align:center">创建者</th>
                            <th style="text-align:center">创建时间</th>
                            <th style="text-align:center">最后修改者</th>
                            <th style="text-align:center">最后修改时间</th>
                            <th style="text-align:center">操作</th>
                        </tr>
                        </thead>

                        <!-- 填充数据 -->
                        <tbody>
                        </tbody>
                    </table>

                    <!-- 分页 -->
                    <iframe src="../base/pageInfo.html" id="iframePageInfo" frameBorder="0" scrolling="no"
                            style="width: 1000px; height: 60px"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 新增/修改 对话框 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    商品信息
                </h4>
            </div>
            <div class="modal-body">
                <form class="bs-example bs-example-form" role="form" enctype="multipart/form-data">
                    <div class="input-group" style="display: none;">
                        <span class="input-group-addon">商品Id</span>
                        <input type="text" name="productId" class="form-control">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon">商品名称</span>
                        <input type="text" name="title" class="form-control" placeholder="请输入商品名称...">
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">商品卖点</span>
                        <input type="text" name="sellPoint" class="form-control" placeholder="请输入商品卖点...">
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">&nbsp;&nbsp;&nbsp;价 格&nbsp;&nbsp;&nbsp;</span>
                        <input type="text" name="price" class="form-control" placeholder="请输入商品价格...">
                        <span class="input-group-addon">.00</span>
                    </div>
                    <br>

                    <!-- 商品种类 -->
                    <div class="input-group">
                        <span class="input-group-addon">商品种类</span>
                        <input id="cidValue" type="text" name="cid" value="0" style="display: none">
                        <div class="dropdown" id="dropdown1">
                            <button type="button" class="btn dropdown-toggle form-control" onclick="setMenus(1)" data-toggle="dropdown" style="border: 1px solid #eee; width: 100px">--请选择--
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                <li role="presentation" class="dropdown-header">一级目录</li>
                            </ul>
                        </div>
                        <div class="dropdown"  id="dropdown2" style="display: none">
                            <button type="button" class="btn dropdown-toggle form-control" onclick="setMenus(2)" data-toggle="dropdown" style="border: 1px solid #eee; width: 100px">--请选择--
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
                                <li role="presentation" class="dropdown-header">二级目录</li>
                            </ul>
                        </div>
                        <div class="dropdown"  id="dropdown3" style="display: none">
                            <button type="button" class="btn dropdown-toggle form-control" onclick="setMenus(3)" data-toggle="dropdown" style="border: 1px solid #eee; width: 100px">--请选择--
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu3">
                                <li role="presentation" class="dropdown-header">三级目录</li>
                            </ul>
                        </div>
                    </div>
                    <br>

                    <!-- 商品图片 -->
                    <div class="input-group" style="display: none">
                        <label>
                            <input type="text" id="image" name="image" class="form-control">
                        </label>
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">商品图片</span>
                        <img src="" id="img00" onclick="delImg('img00')" class="form-control"
                             style='display:none; background-size:cover; width: 100px; height: 100px; border: none'>
                        <img src="" id="img01" onclick="delImg('img01')" class="form-control"
                             style='display:none; background-size:cover; width: 100px; height: 100px; border: none'>
                        <img src="" id="img02" onclick="delImg('img02')" class="form-control"
                             style='display:none; background-size:cover; width: 100px; height: 100px; border: none'>
                        <input type="file" id="uploaderImgs" class="form-control" onchange="updateImg()" multiple
                               style='background-image: url("../../static/mypic/uploader.png"); background-size:cover; width: 100px; height: 100px; border: none'>
                    </div>

                    <!-- 弹框提示框 -->
                    <div class="alert alert-success" id="alertSuccess02" style="display: none;">
                    </div>
                    <div class="alert alert-danger" id="alertFail02" style="display: none;">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
                <button type="button" id="submitForm" class="btn btn-primary" data-dismiss="modal" onclick="updateOrAdd()">
                    提交
                </button>
            </div>
        </div>
    </div>
</div>

</body>

</html>
