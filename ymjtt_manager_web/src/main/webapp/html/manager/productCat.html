<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商品类别</title>

    <link href="../../static/favicon.ico" rel="shortcut icon">
    <link href="../../static/css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../../static/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../static/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../../static/css/animate.css" rel="stylesheet">

    <script src="../../static/js/jquery.min.js?v=2.1.4"></script>
    <script src="../../static/js/bootstrap.min.js?v=3.3.6"></script>
    <script src="../../static/js/plugins/jeditable/jquery.jeditable.js"></script>
    <script src="../../static/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="../../static/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="../../static/myjs/jquery.serializejson.min.js"></script>
    <script src="../../static/myjs/crud.js"></script>
    <script src="../../static/myjs/menu.js"></script>

    <script>

        /* 商品Controller Url */
        var commonUrl = "../../manager/productCat";

        /* 显示数据 */
        function showData(pid, num) {
            if (undefined == num) {
                $(".ibox-content ol").remove();
            }

            if (null == num) {
                num = 1;
                pid = 0;
            }
            //只显示三级目录
            if (4 == num) {
                return;
            }

            //防止反复拼接
            if (undefined != $("#n" + pid + " > li > ol").html()) {
                $("#n" + pid + " > li > ol").remove();
                return;
            }

            //展示数据
            var url = commonUrl + "/listByPid?pid=" + pid;
            $.get(url, function (data) {
                if(200 == data.code) {
                    var productCatArray = data.data;
                    var addHtml = '';
                    var anyId = '';
                    for(var i = 0; i < productCatArray.length; i++) {
                        anyId = productCatArray[i].id;
                        addHtml += '<ol class="dd-list" id="'+ "n" + productCatArray[i].id +'">';
                        addHtml += '<li class="dd-item">';
                        addHtml += '<div class="dd-handle" id="'+ productCatArray[i].id +'">';
                        addHtml += '<span onclick="showData('+ productCatArray[i].id +','+ (num + 1) +')"><span class="label label-info"><i class="fa"></i></span> ' + productCatArray[i].name +'</span>';
                        if (false == productCatArray[i].parentType) {
                            addHtml +=  '<span style="position:absolute;right:'+ (30 - (num - 1) * 10) +'px">' +
                                        '<button class="btn btn-primary btn-xs" onclick="dataDisplay('+ productCatArray[i].id +')"  data-toggle="modal" data-target="#myModal">修改</button>' +
                                        '<button class="btn btn-danger btn-xs" onclick="del('+ productCatArray[i].id +')">删除</button> </span>';
                        }else {
                            addHtml +=  '<span style="position:absolute;right:'+ (30 - (num - 1) * 10) +'px; top: 2px;">' +
                                        '<button class="btn btn-primary btn-xs" onclick="dataDisplay('+ productCatArray[i].id +', '+ num +')"  data-toggle="modal" data-target="#myModal">修改</button>' +
                                        '<button class="btn btn-default btn-xs" disabled="disabled">删除</button></span>';
                        }
                        addHtml += '</div>';
                        addHtml += '</li>';
                        addHtml += '</ol>';
                    }

                    addHtml += '<ol class="dd-list">';
                    addHtml += '<li class="dd-item" >';
                    addHtml += '<div class="dd-handle">';
                    addHtml += '<button class="label label-info" onclick="clearForm('+ anyId +')" data-toggle="modal" data-target="#myModal"><i class="fa">添加商品种类</i></button>';
                    addHtml += '</div>';
                    addHtml += '</li>';
                    addHtml += '</ol>';

                    $("#" + pid).after(addHtml);
                }
            });
        }

        /* 数据回显 */
        function dataDisplay(id) {
            var mapping = "/getById";
            $.get(commonUrl + mapping + "?id=" + id, function (data) {
                if(200 == data.code) {
                    var productCatDo = data.data.productCatDo;
                    $("input[name='productCatId']").val(productCatDo.productCatId);
                    $("input[name='productCatName']").val(productCatDo.productCatName);
                    $("input[name='productCatStatus']").val(productCatDo.productCatStatus == 1 ? "有效" : "无效");
                    $("input[name='sortOrder']").val(productCatDo.sortOrder);
                    if (productCatDo.parentCat != 1) {
                        $("#haveSonCat").removeAttr("checked");
                        $("#noSonCat").attr("checked", "checked");
                    }

                    showMenus(data);
                }
            });

            $("#submitForm").val("update");
        }

        //回显多级菜单
        function showMenus(data) {
            var menu1 = data.data.menu01;
            var menu2 = data.data.menu02;
            if(null != menu1 && null != menu2) {
                $("#dropdown2 button").text(menu1.productCatName);
                $("#dropdown1 button").text(menu2.productCatName);
                $("#dropdown2").css("display", "inline");
                $("#dropdown1").css("display", "inline");
                $("#cidValue").val(menu1.productCatId);
            }else if(null != menu1 && null == menu2) {
                $("#dropdown1 button").text(menu1.productCatName);
                $("#dropdown1").css("display", "inline");
                $("#dropdown2").css("display", "none");
                $("#cidValue").val(menu1.productCatId);
            }else {
                $("#dropdown2").css("display", "none");
                $("#dropdown1 button").text("最顶层菜单");
                $("#cidValue").val(0);
            }
        }

        //不显示二级目录以下
        function noShowAll() {
            $(".ibox-content > ol > li > ol").css("display", "none");
        }

        /* 清空表单 */
        function clearForm(id) {
            $("#myModal input :text").val("");
            var mapping = "/getById";
            $.get(commonUrl + mapping + "?id=" + id, function (data) {
                if(200 == data.code) {
                    showMenus(data);
                }
            });

            $("#submitForm").val("add");
        }

    </script>

</head>

<body class="gray-bg">

<script>
    $(function () {
        /* 完成加载事件 */
        showData(0, 1);
    });
</script>

<div class="wrapper wrapper-content  animated fadeInRight">

    <!-- 提示框 -->
    <div class="alert alert-success" id="alertSuccess01" style="display: none;">
    </div>
    <div class="alert alert-danger" id="alertFail01" style="display: none;">
    </div>

    <div class="row">
        <div class="col-sm-4">
            <div id="nestable-menu">
                <button type="button" data-action="collapse-all" class="btn btn-white btn-sm" onclick="noShowAll()">收起所有</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>商品类别管理</h5>
                </div>

                <div class="ibox-content">
                    <div class="dd" id="0">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 新增/修改 对话框 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    商品类别
                </h4>
            </div>
            <div class="modal-body">
                <form class="bs-example bs-example-form" role="form" enctype="multipart/form-data">
                    <div class="input-group" style="display: none;">
                        <span class="input-group-addon">商品类别Id</span>
                        <input type="text" name="productCatId" class="form-control">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon">商品类别名称</span>
                        <input type="text" name="productCatName" class="form-control" placeholder="商品类别名称...">
                    </div>
                    <br>
                    <div class="form-group" style="position: relative; top: 0px; margin-bottom: 0px">
                        <span class="input-group-addon" style="width: 100px; display: inline">商品类别状态</span>
                        <select class="form-control" name="productCatStatus" style="width: 100px; display: inline; position: relative; top: 4px;">
                            <option value="1">有效</option>
                            <option value="0">无效</option>
                        </select>
                    </div>
                    <br>
                    <div class="form-group" style="position: relative; top: 0px; margin-bottom: 0px">
                        <span class="input-group-addon" style="width: 100px; display: inline">商品类别排序</span>
                        <select class="form-control" name="sortOrder" style="width: 100px; display: inline; position: relative; top: 2px;">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <br>
                    <!-- 有无子类别 -->
                    <div class="input-group" style="position: relative; top: 0px; margin-bottom: 0px">
                        <span class="input-group-addon">是否有子类别</span>
                        <label class="radio-inline" >
                            <input type="radio" id="haveSonCat" name="parentCat" value="1" checked style="position: absolute; top: 1px; left: 30px">
                            <span  style="width: 70px; position: absolute; top: -8px; left: 25px;">有子类别</span>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" id="noSonCat" name="parentCat" value="0"  style="position: absolute; top: 1px; left: 85px">
                            <span  style="width: 70px; position: absolute; top: -8px; left: 80px;">无子类别</span>
                        </label>
                    </div>
                    <br>

                    <!-- 类别父类型 -->
                    <div class="input-group" style="margin-bottom: 0px">
                        <span class="input-group-addon" style="width: 120px;"> 类别父类型 </span>
                        <input id="cidValue" type="text" name="parentId" value="0" style="display: none">
                        <div class="dropdown" id="dropdown1">
                            <button type="button" class="btn dropdown-toggle form-control" onclick="setMenus(1)" data-toggle="dropdown" style="border: 1px solid #eee; width: 100px">--请选择--
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                <li role="presentation" class="dropdown-header">一级目录</li>
                            </ul>
                        </div>
                        <div class="dropdown"  id="dropdown2" style="display: none">
                            <button type="button" class="btn dropdown-toggle form-control" onclick="setMenus(2)" data-toggle="dropdown" style="border: 1px solid #eee; width: 100px">--请选择--
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
                                <li role="presentation" class="dropdown-header">二级目录</li>
                            </ul>
                        </div>
                    </div>
                    <br>

                    <!-- 弹框提示框 -->
                    <div class="alert alert-success" id="alertSuccess02" style="display: none;">
                    </div>
                    <div class="alert alert-danger" id="alertFail02" style="display: none;">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
                <button type="button" id="submitForm" class="btn btn-primary" data-dismiss="modal" onclick="updateOrAdd()">
                    提交
                </button>
            </div>
        </div>
    </div>
</div>

</body>
</html>